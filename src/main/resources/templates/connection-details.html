<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="'Подключение - ' + ${connection.bankName}">Подключение - Multibank</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #667eea;
            --secondary: #764ba2;
        }

        .detail-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.08);
        }

        .connection-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 40px;
            border-radius: 15px 15px 0 0;
        }

        .bank-logo-large {
            width: 80px;
            height: 80px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            background: rgba(255,255,255,0.2);
            margin-bottom: 20px;
        }

        .info-item {
            display: flex;
            justify-content: between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #f8f9fa;
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .btn-gradient {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border: none;
            color: white;
            font-weight: 600;
            padding: 10px 25px;
            border-radius: 50px;
            transition: all 0.3s ease;
        }

        .btn-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
            color: white;
        }
    </style>
</head>
<body>
<div th:replace="fragments/navbar :: user-navbar"></div>

<div class="container-fluid py-4">
    <div class="container">
        <!-- Хлебные крошки -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/dashboard" class="text-decoration-none">Дашборд</a></li>
                <li class="breadcrumb-item"><a href="/banks" class="text-decoration-none">Банки</a></li>
                <li class="breadcrumb-item active" th:text="${connection.bankName}">Банк</li>
            </ol>
        </nav>

        <!-- Заголовок -->
        <div class="row mb-4">
            <div class="col-12">
                <h2 class="fw-bold text-primary" th:text="${title}">Подключение к банку</h2>
            </div>
        </div>

        <div class="row g-4">
            <!-- Основная информация -->
            <div class="col-lg-8">
                <div class="detail-card">
                    <div class="connection-header text-center">
                        <div class="bank-logo-large mx-auto">
                            <i class="fas fa-university"></i>
                        </div>
                        <h3 class="fw-bold mb-2" th:text="${connection.bankName}">Название банка</h3>
                        <p class="mb-0 opacity-75">Open Banking API подключение</p>
                    </div>
                    <div class="card-body p-4">
                        <h5 class="fw-bold mb-4">
                            <i class="fas fa-info-circle me-2"></i>
                            Информация о подключении
                        </h5>

                        <div class="info-item">
                            <div>
                                <strong>Статус подключения</strong>
                                <p class="text-muted mb-0" th:text="${connection.active ? 'Активно' : 'Неактивно'}">Статус</p>
                            </div>
                            <span th:classappend="|badge ${connection.active ? 'bg-success' : 'bg-secondary'}|"
                                  th:text="${connection.active ? 'АКТИВНО' : 'НЕАКТИВНО'}">Статус</span>
                        </div>

                        <div class="info-item">
                            <div>
                                <strong>ID подключения</strong>
                                <p class="text-muted mb-0" th:text="${connection.bankId}">bank_id</p>
                            </div>
                            <i class="fas fa-id-card text-muted"></i>
                        </div>

                        <div class="info-item">
                            <div>
                                <strong>Дата подключения</strong>
                                <p class="text-muted mb-0" th:text="${#temporals.format(connection.connectedAt, 'dd.MM.yyyy HH:mm')}">01.01.2024 12:00</p>
                            </div>
                            <i class="fas fa-calendar text-muted"></i>
                        </div>

                        <div class="info-item">
                            <div>
                                <strong>Последняя синхронизация</strong>
                                <p class="text-muted mb-0"
                                   th:text="${connection.lastSyncAt != null ? #temporals.format(connection.lastSyncAt, 'dd.MM.yyyy HH:mm') : 'Никогда'}">
                                    Дата
                                </p>
                            </div>
                            <i class="fas fa-sync-alt text-muted"></i>
                        </div>

                        <div class="info-item">
                            <div>
                                <strong>Область доступа (Scope)</strong>
                                <p class="text-muted mb-0" th:text="${connection.scope}">accounts payments openid</p>
                            </div>
                            <i class="fas fa-shield-alt text-muted"></i>
                        </div>

                        <div th:if="${connection.tokenExpiry != null}" class="info-item">
                            <div>
                                <strong>Срок действия токена</strong>
                                <p class="text-muted mb-0" th:text="${#temporals.format(connection.tokenExpiry, 'dd.MM.yyyy HH:mm')}">01.01.2024 12:00</p>
                            </div>
                            <i class="fas fa-clock text-muted"></i>
                        </div>
                    </div>
                </div>

                <!-- Действия -->
                <div class="detail-card mt-4">
                    <div class="card-body p-4">
                        <h5 class="fw-bold mb-4">
                            <i class="fas fa-cogs me-2"></i>
                            Управление подключением
                        </h5>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <form th:action="@{/sync/{bankId}(bankId=${connection.bankId})}" method="post">
                                    <button type="submit" class="btn btn-outline-primary w-100">
                                        <i class="fas fa-sync-alt me-2"></i>
                                        Синхронизировать
                                    </button>
                                </form>
                            </div>
                            <div class="col-md-4">
                                <form th:action="@{/activate/{bankId}(bankId=${connection.bankId})}" method="post">
                                    <button type="submit" class="btn btn-outline-success w-100"
                                            th:disabled="${connection.active}">
                                        <i class="fas fa-power-off me-2"></i>
                                        <span th:text="${connection.active ? 'Активировано' : 'Активировать'}">Активировать</span>
                                    </button>
                                </form>
                            </div>
                            <div class="col-md-4">
                                <form th:action="@{/disconnect/{bankId}(bankId=${connection.bankId})}" method="post">
                                    <button type="submit" class="btn btn-outline-warning w-100"
                                            onclick="return confirm('Вы уверены, что хотите отключить это подключение?')">
                                        <i class="fas fa-unlink me-2"></i>
                                        Отключить
                                    </button>
                                </form>
                            </div>
                            <div class="col-md-6">
                                <a th:href="@{/connect/{bankId}(bankId=${connection.bankId})}" class="btn btn-outline-info w-100">
                                    <i class="fas fa-redo me-2"></i>
                                    Переподключить
                                </a>
                            </div>
                            <div class="col-md-6">
                                <form th:action="@{/delete/{bankId}(bankId=${connection.bankId})}" method="post">
                                    <button type="submit" class="btn btn-outline-danger w-100"
                                            onclick="return confirm('ВНИМАНИЕ! Это действие полностью удалит подключение и все связанные данные. Продолжить?')">
                                        <i class="fas fa-trash me-2"></i>
                                        Удалить
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Информация о Banking API -->
            <div class="col-lg-4">
                <div class="detail-card">
                    <div class="card-body p-4">
                        <h5 class="fw-bold mb-4">
                            <i class="fas fa-code me-2"></i>
                            Banking API информация
                        </h5>

                        <div th:if="${apiInfo}" class="mb-4">
                            <div class="mb-3">
                                <strong>Провайдер API</strong>
                                <p class="text-muted mb-0" th:text="${apiInfo.api_provider}">Banking API</p>
                            </div>

                            <div class="mb-3">
                                <strong>Базовый URL</strong>
                                <p class="text-muted mb-0" th:text="${apiInfo.base_url}">https://api.bankingapi.ru</p>
                            </div>

                            <div class="mb-3">
                                <strong>Метод аутентификации</strong>
                                <p class="text-muted mb-0" th:text="${apiInfo.auth_method}">OAuth2 Client Credentials</p>
                            </div>

                            <div class="mb-3">
                                <strong>Статус API</strong>
                                <p class="text-muted mb-0">
                                    <span th:classappend="|badge bg-${apiInfo.status == 'Active' ? 'success' : 'warning'}|"
                                          th:text="${apiInfo.status}">Статус</span>
                                </p>
                            </div>

                            <div>
                                <strong>Последнее обновление</strong>
                                <p class="text-muted mb-0" th:text="${apiInfo.last_updated}">2024-01-01T12:00:00</p>
                            </div>
                        </div>

                        <div th:unless="${apiInfo}" class="text-center py-4">
                            <i class="fas fa-exclamation-triangle fa-2x text-warning mb-3"></i>
                            <p class="text-muted">Информация о API недоступна</p>
                        </div>
                    </div>
                </div>

                <!-- Быстрые ссылки -->
                <div class="detail-card mt-4">
                    <div class="card-body p-4">
                        <h5 class="fw-bold mb-4">
                            <i class="fas fa-rocket me-2"></i>
                            Быстрые действия
                        </h5>
                        <div class="d-grid gap-2">
                            <a href="/transfer" class="btn btn-outline-primary text-start">
                                <i class="fas fa-exchange-alt me-2"></i>
                                Переводы
                            </a>
                            <a th:href="@{/api/accounts/{bankId}(bankId=${connection.bankId})}" class="btn btn-outline-success text-start">
                                <i class="fas fa-wallet me-2"></i>
                                Счета API
                            </a>
                            <a th:href="@{/api/test-connection}" class="btn btn-outline-info text-start">
                                <i class="fas fa-bolt me-2"></i>
                                Тест подключения
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>